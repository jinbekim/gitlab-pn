{"version":3,"file":"index-MTt3uu6m.js","sources":["../../../src/utils/chrome/index.ts","../../../src/domain/pn/index.ts","../../../src/plugins/popup/index.ts"],"sourcesContent":["/**\n * Chrome storage API wrappers with error handling\n */\n\nexport type StorageResult<T> = {\n  success: true;\n  data: T;\n} | {\n  success: false;\n  error: Error;\n};\n\n/**\n * Saves data to Chrome local storage\n */\nexport function saveToChromeLocalStorage(map: Record<string, unknown>): Promise<StorageResult<void>> {\n  return new Promise((resolve) => {\n    try {\n      chrome.storage.local.set(map, () => {\n        if (chrome.runtime.lastError) {\n          resolve({\n            success: false,\n            error: new Error(chrome.runtime.lastError.message),\n          });\n        } else {\n          resolve({ success: true, data: undefined });\n        }\n      });\n    } catch (error) {\n      resolve({\n        success: false,\n        error: error instanceof Error ? error : new Error(String(error)),\n      });\n    }\n  });\n}\n\n/**\n * Gets all data from Chrome local storage\n */\nexport function getAllFromChromeLocalStorage(): Promise<Record<string, unknown>> {\n  return new Promise((resolve, reject) => {\n    try {\n      chrome.storage.local.get((data) => {\n        if (chrome.runtime.lastError) {\n          reject(new Error(chrome.runtime.lastError.message));\n        } else {\n          resolve(data);\n        }\n      });\n    } catch (error) {\n      reject(error instanceof Error ? error : new Error(String(error)));\n    }\n  });\n}\n\n/**\n * Subscribes to Chrome storage changes\n * Returns an unsubscribe function\n */\nexport function subscribeToChromeStorage(\n  callback: (changes: { [k: string]: chrome.storage.StorageChange }) => void\n): () => void {\n  chrome.storage.onChanged.addListener(callback);\n  return () => {\n    chrome.storage.onChanged.removeListener(callback);\n  };\n}\n","export type PnRule = \"p1\" | \"p2\" | \"p3\";\nexport type PnRuleSub = \"P1\" | \"P2\" | \"P3\";\nexport type PnBgColorKey = `${PnRule}-bg-color`;\nexport type PnTextColorKey = `${PnRule}-text-color`;\n\nexport type PnRuleMap = {\n  [key in PnRule]: string;\n};\nexport type PnRuleColorMap = {\n  [key in PnBgColorKey | PnTextColorKey]?: string;\n};\nexport type PnRuleMapWithColor = PnRuleMap & PnRuleColorMap;\n\nexport const DEFAULT_PN_RULE_MAP: PnRuleMapWithColor = {\n  p1: \"P1\",\n  p2: \"P2\",\n  p3: \"P3\",\n  \"p1-bg-color\": \"#dc2626\",\n  \"p1-text-color\": \"#ffffff\",\n  \"p2-bg-color\": \"#f59e0b\",\n  \"p2-text-color\": \"#ffffff\",\n  \"p3-bg-color\": \"#10b981\",\n  \"p3-text-color\": \"#ffffff\",\n};\n\nexport function getBgColorKey(pn: PnRule | PnRuleSub): PnBgColorKey {\n  return `${pn}-bg-color`.toLocaleLowerCase() as PnBgColorKey;\n}\n\nexport function getTextColorKey(pn: PnRule | PnRuleSub): PnTextColorKey {\n  return `${pn}-text-color`.toLocaleLowerCase() as PnTextColorKey;\n}\n\nexport function getReplacementKey(pn: PnRule | PnRuleSub): PnRule {\n  return pn.toLocaleLowerCase() as PnRule;\n}\n\nfunction pnRegexp() {\n  return /^([pP]\\d)\\s*[:.]?/;\n}\n\nexport function findPn(text: string) {\n  const match = text.match(pnRegexp());\n  return match?.[1];\n}\n\nexport function isPnRule(rule: string = \"\"): rule is PnRule {\n  return pnRegexp().test(rule);\n}\n\nexport function isPnRuleMap(map: unknown): map is PnRuleMapWithColor {\n  if (typeof map !== \"object\" || map === null) return false;\n  return [\"p1\", \"p2\", \"p3\"].every((key) => key in map);\n}\n","import 'virtual:uno.css';\nimport './index.css';\nimport { getAllFromChromeLocalStorage, saveToChromeLocalStorage } from \"@utils/chrome\";\nimport { getBgColorKey, getTextColorKey, PnRule } from \"@domain/pn\";\n\nconst form = document.querySelector(\"form\");\n\n// GitLab preset colors\nconst PRESET_BG_COLORS = [\n  '#dc143c', '#ed9121', '#eee600', '#009966',\n  '#3cb371', '#6699cc', '#9400d3', '#808080'\n];\nconst PRESET_TEXT_COLORS = ['#ffffff', '#000000'];\n\nconst PN_RULES: PnRule[] = ['p1', 'p2', 'p3'];\n\nfunction renderColorPalette(\n  container: Element,\n  colors: string[],\n  hiddenInput: HTMLInputElement,\n  onSelect: () => void\n): void {\n  container.innerHTML = '';\n  const currentValue = hiddenInput.value.toLowerCase();\n\n  colors.forEach(color => {\n    const swatch = document.createElement('div');\n    swatch.className = 'color-swatch';\n    if (color.toLowerCase() === currentValue) {\n      swatch.classList.add('selected');\n    }\n    swatch.style.backgroundColor = color;\n    swatch.addEventListener('click', () => {\n      container.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('selected'));\n      swatch.classList.add('selected');\n      hiddenInput.value = color;\n      onSelect();\n    });\n    container.appendChild(swatch);\n  });\n}\n\nfunction updateBadgePreview(pn: PnRule): void {\n  const badge = document.getElementById(`${pn}-badge`);\n  const bgInput = document.querySelector(`[name=\"${pn}-bg-color\"]`) as HTMLInputElement;\n  const textInput = document.querySelector(`[name=\"${pn}-text-color\"]`) as HTMLInputElement;\n\n  if (badge && bgInput && textInput) {\n    badge.style.backgroundColor = bgInput.value;\n    badge.style.color = textInput.value;\n  }\n}\n\nfunction initPalettes(): void {\n  PN_RULES.forEach(pn => {\n    const bgPalette = document.querySelector(`[data-target=\"${pn}-bg-color\"]`);\n    const textPalette = document.querySelector(`[data-target=\"${pn}-text-color\"]`);\n    const bgInput = document.querySelector(`[name=\"${pn}-bg-color\"]`) as HTMLInputElement;\n    const textInput = document.querySelector(`[name=\"${pn}-text-color\"]`) as HTMLInputElement;\n\n    if (bgPalette && bgInput) {\n      renderColorPalette(bgPalette, PRESET_BG_COLORS, bgInput, () => updateBadgePreview(pn));\n    }\n    if (textPalette && textInput) {\n      renderColorPalette(textPalette, PRESET_TEXT_COLORS, textInput, () => updateBadgePreview(pn));\n    }\n\n    updateBadgePreview(pn);\n  });\n}\n\nfunction loadValues(): void {\n  getAllFromChromeLocalStorage().then((data) => {\n    PN_RULES.forEach(pn => {\n      const bgInput = document.querySelector(`[name=\"${pn}-bg-color\"]`) as HTMLInputElement;\n      const textInput = document.querySelector(`[name=\"${pn}-text-color\"]`) as HTMLInputElement;\n\n      if (bgInput && data[getBgColorKey(pn)]) {\n        bgInput.value = data[getBgColorKey(pn)] as string;\n      }\n      if (textInput && data[getTextColorKey(pn)]) {\n        textInput.value = data[getTextColorKey(pn)] as string;\n      }\n    });\n\n    initPalettes();\n  });\n}\n\nfunction init(): void {\n  form?.addEventListener(\"submit\", async (e) => {\n    e.preventDefault();\n    const formData = new FormData(form);\n    const map: Record<string, FormDataEntryValue> = {};\n\n    formData.forEach((value, key) => {\n      map[key] = value;\n    });\n\n    await saveToChromeLocalStorage(map);\n    window.close();\n  });\n}\n\nloadValues();\ninit();\n"],"names":["saveToChromeLocalStorage","map","resolve","error","getAllFromChromeLocalStorage","reject","data","getBgColorKey","pn","getTextColorKey","form","PRESET_BG_COLORS","PRESET_TEXT_COLORS","PN_RULES","renderColorPalette","container","colors","hiddenInput","onSelect","currentValue","color","swatch","s","updateBadgePreview","badge","bgInput","textInput","initPalettes","bgPalette","textPalette","loadValues","init","formData","value","key"],"mappings":"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"}