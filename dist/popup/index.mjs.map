{"version":3,"sources":["../../src/utils/chrome/index.ts","../../src/domain/pn/index.ts","../../src/features/popup/index.ts"],"sourcesContent":["/**\n * Chrome storage API wrappers with error handling\n */\n\nexport type StorageResult<T> = {\n  success: true;\n  data: T;\n} | {\n  success: false;\n  error: Error;\n};\n\n/**\n * Saves data to Chrome local storage\n */\nexport function saveToChromeLocalStorage(map: Record<string, unknown>): Promise<StorageResult<void>> {\n  return new Promise((resolve) => {\n    try {\n      chrome.storage.local.set(map, () => {\n        if (chrome.runtime.lastError) {\n          resolve({\n            success: false,\n            error: new Error(chrome.runtime.lastError.message),\n          });\n        } else {\n          resolve({ success: true, data: undefined });\n        }\n      });\n    } catch (error) {\n      resolve({\n        success: false,\n        error: error instanceof Error ? error : new Error(String(error)),\n      });\n    }\n  });\n}\n\n/**\n * Gets all data from Chrome local storage\n */\nexport function getAllFromChromeLocalStorage(): Promise<Record<string, unknown>> {\n  return new Promise((resolve, reject) => {\n    try {\n      chrome.storage.local.get((data) => {\n        if (chrome.runtime.lastError) {\n          reject(new Error(chrome.runtime.lastError.message));\n        } else {\n          resolve(data);\n        }\n      });\n    } catch (error) {\n      reject(error instanceof Error ? error : new Error(String(error)));\n    }\n  });\n}\n\n/**\n * Subscribes to Chrome storage changes\n * Returns an unsubscribe function\n */\nexport function subscribeToChromeStorage(\n  callback: (changes: { [k: string]: chrome.storage.StorageChange }) => void\n): () => void {\n  chrome.storage.onChanged.addListener(callback);\n  return () => {\n    chrome.storage.onChanged.removeListener(callback);\n  };\n}\n","export type PnRule = \"p1\" | \"p2\" | \"p3\";\nexport type PnRuleSub = \"P1\" | \"P2\" | \"P3\";\nexport type PnBgColorKey = `${PnRule}-bg-color`;\nexport type PnTextColorKey = `${PnRule}-text-color`;\n\nexport type PnRuleMap = {\n  [key in PnRule]: string;\n};\nexport type PnRuleColorMap = {\n  [key in PnBgColorKey | PnTextColorKey]?: string;\n};\nexport type PnRuleMapWithColor = PnRuleMap & PnRuleColorMap;\n\nexport function getBgColorKey(pn: PnRule | PnRuleSub): PnBgColorKey {\n  return `${pn}-bg-color`.toLocaleLowerCase() as PnBgColorKey;\n}\n\nexport function getTextColorKey(pn: PnRule | PnRuleSub): PnTextColorKey {\n  return `${pn}-text-color`.toLocaleLowerCase() as PnTextColorKey;\n}\n\nexport function getReplacementKey(pn: PnRule | PnRuleSub): PnRule {\n  return pn.toLocaleLowerCase() as PnRule;\n}\n\nfunction pnRegexp() {\n  return /^([pP]\\d)\\s*[:.]?/;\n}\n\nexport function findPn(text: string) {\n  const match = text.match(pnRegexp());\n  return match?.[1];\n}\n\nexport function isPnRule(rule: string = \"\"): rule is PnRule {\n  return pnRegexp().test(rule);\n}\n\nexport function isPnRuleMap(map: unknown): map is PnRuleMapWithColor {\n  if (typeof map !== \"object\" || map === null) return false;\n  return [\"p1\", \"p2\", \"p3\"].every((key) => key in map);\n}\n","import { getAllFromChromeLocalStorage, saveToChromeLocalStorage } from \"@utils/chrome\";\nimport { getReplacementKey, getBgColorKey, getTextColorKey, isPnRuleMap, PnRule } from \"@domain/pn\";\n\nconst form = document.querySelector(\"form\");\nconst bgColorInputs = document.querySelectorAll(\"[name$='-bg-color']\");\nconst textColorInputs = document.querySelectorAll(\"[name$='-text-color']\");\nconst pnRuleToggle = document.getElementById(\"pn-rule-enabled\") as HTMLInputElement;\nconst rmMrFilterToggle = document.getElementById(\"rm-mr-filter-enabled\") as HTMLInputElement;\n\nconst STORAGE_KEYS = {\n  PN_RULE_ENABLED: \"pn-rule-enabled\",\n  RM_MR_FILTER_ENABLED: \"rm-mr-filter-enabled\",\n} as const;\n\nfunction getValues(): void {\n  getAllFromChromeLocalStorage().then((data) => {\n    // Load toggle states (default to true if not set)\n    pnRuleToggle.checked = data[STORAGE_KEYS.PN_RULE_ENABLED] !== false;\n    rmMrFilterToggle.checked = data[STORAGE_KEYS.RM_MR_FILTER_ENABLED] !== false;\n\n    if (!isPnRuleMap(data)) return;\n\n    Object.keys(data).forEach((key) => {\n      const input = document.querySelector(`[name='${key}']`);\n      const pn = key as PnRule;\n      if (input instanceof HTMLInputElement) {\n        input.value = data[getReplacementKey(pn)] as string || pn;\n        input.style.backgroundColor = data[getBgColorKey(pn)] as string || \"transparent\";\n        input.style.color = data[getTextColorKey(pn)] as string || \"black\";\n      }\n    });\n  });\n}\n\nfunction init(): void {\n  // Toggle event listeners\n  pnRuleToggle.addEventListener(\"change\", () => {\n    saveToChromeLocalStorage({ [STORAGE_KEYS.PN_RULE_ENABLED]: pnRuleToggle.checked });\n  });\n\n  rmMrFilterToggle.addEventListener(\"change\", () => {\n    saveToChromeLocalStorage({ [STORAGE_KEYS.RM_MR_FILTER_ENABLED]: rmMrFilterToggle.checked });\n  });\n\n  bgColorInputs.forEach((input) => {\n    input.addEventListener(\"input\", (e) => {\n      const target = e.target as HTMLInputElement;\n      const name = target.name;\n      const textInput = document.querySelector(\n        `[name='${name.replace(\"-bg-color\", \"\")}']`\n      ) as HTMLInputElement;\n      textInput.style.backgroundColor = target.value;\n    });\n  });\n\n  textColorInputs.forEach((input) => {\n    input.addEventListener(\"input\", (e) => {\n      const target = e.target as HTMLInputElement;\n      const name = target.name;\n      const textInput = document.querySelector(\n        `[name='${name.replace(\"-text-color\", \"\")}']`\n      ) as HTMLInputElement;\n      textInput.style.color = target.value;\n    });\n  });\n\n  form?.addEventListener(\"submit\", (e) => {\n    e.preventDefault();\n    const formData = new FormData(form);\n    const map: Record<string, FormDataEntryValue> = {};\n\n    formData.forEach((value, key) => {\n      map[key] = value;\n    });\n\n    saveToChromeLocalStorage(map);\n\n    window.close();\n  });\n}\n\ngetValues();\ninit();\n"],"mappings":"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","names":[]}