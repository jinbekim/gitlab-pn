{"version":3,"file":"index.global.js","sources":["../../src/utils/chrome/index.ts","../../src/core/storage/StorageService.ts","../../src/core/events/EventBus.ts","../../src/services/gitlab/selectors.ts","../../src/services/gitlab/index.ts","../../src/core/plugin/PluginContext.ts","../../src/core/plugin/PluginManager.ts","../../src/core/plugin/types.ts","../../src/domain/pn/index.ts","../../src/utils/observer/index.ts","../../src/utils/debounce.ts","../../src/domain/html/index.ts","../../src/utils/html/index.ts","../../src/plugins/pn-rule/replacer.ts","../../src/plugins/pn-rule/observer.ts","../../src/plugins/pn-rule/PnRulePlugin.ts","../../src/plugins/rm-mr-filter/utils.ts","../../src/plugins/rm-mr-filter/ui/RemoveButton.ts","../../src/plugins/rm-mr-filter/RmMrFilterPlugin.ts","../../src/plugins/inject/index.ts"],"sourcesContent":["/**\n * Chrome storage API wrappers with error handling\n */\n\nexport type StorageResult<T> = {\n  success: true;\n  data: T;\n} | {\n  success: false;\n  error: Error;\n};\n\n/**\n * Saves data to Chrome local storage\n */\nexport function saveToChromeLocalStorage(map: Record<string, unknown>): Promise<StorageResult<void>> {\n  return new Promise((resolve) => {\n    try {\n      chrome.storage.local.set(map, () => {\n        if (chrome.runtime.lastError) {\n          resolve({\n            success: false,\n            error: new Error(chrome.runtime.lastError.message),\n          });\n        } else {\n          resolve({ success: true, data: undefined });\n        }\n      });\n    } catch (error) {\n      resolve({\n        success: false,\n        error: error instanceof Error ? error : new Error(String(error)),\n      });\n    }\n  });\n}\n\n/**\n * Gets all data from Chrome local storage\n */\nexport function getAllFromChromeLocalStorage(): Promise<Record<string, unknown>> {\n  return new Promise((resolve, reject) => {\n    try {\n      chrome.storage.local.get((data) => {\n        if (chrome.runtime.lastError) {\n          reject(new Error(chrome.runtime.lastError.message));\n        } else {\n          resolve(data);\n        }\n      });\n    } catch (error) {\n      reject(error instanceof Error ? error : new Error(String(error)));\n    }\n  });\n}\n\n/**\n * Subscribes to Chrome storage changes\n * Returns an unsubscribe function\n */\nexport function subscribeToChromeStorage(\n  callback: (changes: { [k: string]: chrome.storage.StorageChange }) => void\n): () => void {\n  chrome.storage.onChanged.addListener(callback);\n  return () => {\n    chrome.storage.onChanged.removeListener(callback);\n  };\n}\n","/**\n * Typed storage service wrapping Chrome storage API\n */\n\nimport {\n  getAllFromChromeLocalStorage,\n  saveToChromeLocalStorage,\n  subscribeToChromeStorage,\n  type StorageResult,\n} from '@utils/chrome';\n\nexport type { StorageResult };\n\nexport type StorageChanges = { [key: string]: chrome.storage.StorageChange };\n\n/**\n * StorageService provides typed access to Chrome storage\n */\nexport class StorageService {\n  private cache: Record<string, unknown> = {};\n  private initialized = false;\n\n  /**\n   * Initialize the storage service by loading all data\n   */\n  async init(): Promise<void> {\n    if (this.initialized) return;\n    this.cache = await getAllFromChromeLocalStorage();\n    this.initialized = true;\n  }\n\n  /**\n   * Get all storage data\n   */\n  async getAll(): Promise<Record<string, unknown>> {\n    if (!this.initialized) {\n      await this.init();\n    }\n    return { ...this.cache };\n  }\n\n  /**\n   * Get a specific value from storage\n   * @param key Storage key\n   * @param defaultValue Default value if key doesn't exist\n   */\n  async get<T>(key: string, defaultValue?: T): Promise<T | undefined> {\n    if (!this.initialized) {\n      await this.init();\n    }\n    const value = this.cache[key];\n    return value !== undefined ? (value as T) : defaultValue;\n  }\n\n  /**\n   * Save data to storage\n   * @param data Data to save\n   */\n  async save(data: Record<string, unknown>): Promise<StorageResult<void>> {\n    const result = await saveToChromeLocalStorage(data);\n    if (result.success) {\n      // Update cache\n      Object.assign(this.cache, data);\n    }\n    return result;\n  }\n\n  /**\n   * Subscribe to storage changes\n   * @param callback Callback for storage changes\n   * @returns Unsubscribe function\n   */\n  subscribe(callback: (changes: StorageChanges) => void): () => void {\n    return subscribeToChromeStorage((changes) => {\n      // Update cache with changes\n      Object.entries(changes).forEach(([key, change]) => {\n        if (change.newValue !== undefined) {\n          this.cache[key] = change.newValue;\n        } else {\n          delete this.cache[key];\n        }\n      });\n      callback(changes);\n    });\n  }\n}\n\n/**\n * Shared storage service instance\n */\nexport const storageService = new StorageService();\n","/**\n * Simple pub/sub event bus\n */\n\ntype EventCallback<T = unknown> = (data: T) => void;\n\ninterface EventSubscription {\n  callback: EventCallback;\n  once: boolean;\n}\n\n/**\n * EventBus provides a simple pub/sub mechanism for plugin communication\n */\nexport class EventBus {\n  private events: Map<string, EventSubscription[]> = new Map();\n\n  /**\n   * Subscribe to an event\n   * @param event Event name\n   * @param callback Callback function\n   * @returns Unsubscribe function\n   */\n  on<T = unknown>(event: string, callback: EventCallback<T>): () => void {\n    const subscription: EventSubscription = {\n      callback: callback as EventCallback,\n      once: false,\n    };\n\n    const subscribers = this.events.get(event) || [];\n    subscribers.push(subscription);\n    this.events.set(event, subscribers);\n\n    return () => this.off(event, callback);\n  }\n\n  /**\n   * Subscribe to an event only once\n   * @param event Event name\n   * @param callback Callback function\n   * @returns Unsubscribe function\n   */\n  once<T = unknown>(event: string, callback: EventCallback<T>): () => void {\n    const subscription: EventSubscription = {\n      callback: callback as EventCallback,\n      once: true,\n    };\n\n    const subscribers = this.events.get(event) || [];\n    subscribers.push(subscription);\n    this.events.set(event, subscribers);\n\n    return () => this.off(event, callback);\n  }\n\n  /**\n   * Emit an event\n   * @param event Event name\n   * @param data Event data\n   */\n  emit<T = unknown>(event: string, data?: T): void {\n    const subscribers = this.events.get(event);\n    if (!subscribers) return;\n\n    const remainingSubscribers: EventSubscription[] = [];\n\n    subscribers.forEach((subscription) => {\n      subscription.callback(data);\n      if (!subscription.once) {\n        remainingSubscribers.push(subscription);\n      }\n    });\n\n    if (remainingSubscribers.length > 0) {\n      this.events.set(event, remainingSubscribers);\n    } else {\n      this.events.delete(event);\n    }\n  }\n\n  /**\n   * Unsubscribe from an event\n   * @param event Event name\n   * @param callback Callback function to remove\n   */\n  off<T = unknown>(event: string, callback: EventCallback<T>): void {\n    const subscribers = this.events.get(event);\n    if (!subscribers) return;\n\n    const filtered = subscribers.filter((s) => s.callback !== callback);\n\n    if (filtered.length > 0) {\n      this.events.set(event, filtered);\n    } else {\n      this.events.delete(event);\n    }\n  }\n\n  /**\n   * Clear all event subscriptions\n   */\n  clear(): void {\n    this.events.clear();\n  }\n}\n\n/**\n * Shared event bus instance\n */\nexport const eventBus = new EventBus();\n","/**\n * GitLab DOM Selectors\n * Centralized selectors for GitLab-specific elements\n */\n\nexport const SELECTORS = {\n  // Note elements in MR discussion\n  notes: \"div.note-body > div.note-text.md [data-sourcepos][dir='auto']\",\n\n  // Filter dropdown elements\n  filterDropdown: 'div.filtered-search-history-dropdown',\n  filterDropdownButton: 'button.filtered-search-history-dropdown-toggle-button',\n  filterListItem: 'li[data-testid=\"dropdown-item\"]:not(.gl-text-subtle)',\n\n  // Custom remove button class\n  customRemoveButton: '.custom-rm-btn',\n} as const;\n\nexport type SelectorKey = keyof typeof SELECTORS;\n","import { SELECTORS } from './selectors';\n\nexport function getNotes() {\n  return document.querySelectorAll(SELECTORS.notes);\n}\n\nexport function getFilterDropdown() {\n  return document.querySelector(SELECTORS.filterDropdown);\n}\n\nexport function getFilterDropdownButton() {\n  return document.querySelector(SELECTORS.filterDropdownButton);\n}\n\nexport function getFilterListItems() {\n  const dropdown = getFilterDropdown();\n  if (!dropdown) return null;\n  return dropdown.querySelectorAll(SELECTORS.filterListItem);\n}\n\nexport { SELECTORS };\n","/**\n * Plugin context providing shared services to plugins\n */\n\nimport { EventBus, eventBus } from '@core/events';\nimport { StorageService, storageService } from '@core/storage';\nimport * as gitlab from '@services/gitlab';\n\n/**\n * Services available to plugins through context\n */\nexport interface PluginContext {\n  /** Storage service for Chrome storage operations */\n  storage: StorageService;\n  /** Event bus for plugin communication */\n  eventBus: EventBus;\n  /** GitLab DOM accessor functions */\n  gitlab: typeof gitlab;\n}\n\n/**\n * Creates a plugin context with all available services\n */\nexport function createPluginContext(): PluginContext {\n  return {\n    storage: storageService,\n    eventBus: eventBus,\n    gitlab,\n  };\n}\n","/**\n * Plugin lifecycle manager\n */\n\nimport { storageService, type StorageChanges } from '@core/storage';\nimport { createPluginContext, type PluginContext } from './PluginContext';\nimport type { Plugin } from './types';\n\n/**\n * PluginManager handles plugin lifecycle and coordination\n */\nexport class PluginManager {\n  private plugins: Map<string, Plugin> = new Map();\n  private context: PluginContext;\n  private unsubscribeStorage: (() => void) | null = null;\n\n  constructor() {\n    this.context = createPluginContext();\n  }\n\n  /**\n   * Register a plugin with the manager\n   * @param plugin Plugin instance to register\n   */\n  register(plugin: Plugin): void {\n    if (this.plugins.has(plugin.meta.id)) {\n      console.warn(`Plugin ${plugin.meta.id} is already registered`);\n      return;\n    }\n    this.plugins.set(plugin.meta.id, plugin);\n  }\n\n  /**\n   * Initialize all registered plugins\n   */\n  async initAll(): Promise<void> {\n    // Initialize storage service first\n    await storageService.init();\n\n    // Subscribe to storage changes\n    this.unsubscribeStorage = storageService.subscribe((changes) => {\n      this.handleStorageChanges(changes);\n    });\n\n    // Get initial storage data\n    const storageData = await storageService.getAll();\n\n    // Initialize and start each plugin\n    for (const plugin of this.plugins.values()) {\n      try {\n        await plugin.init(this.context);\n\n        // Check if plugin should be enabled (default to true if not set)\n        const isEnabled = storageData[plugin.meta.enabledKey] !== false;\n\n        if (isEnabled) {\n          await plugin.start();\n        }\n      } catch (error) {\n        console.error(`Failed to initialize plugin ${plugin.meta.id}:`, error);\n      }\n    }\n  }\n\n  /**\n   * Cleanup all plugins\n   */\n  cleanupAll(): void {\n    // Unsubscribe from storage changes\n    if (this.unsubscribeStorage) {\n      this.unsubscribeStorage();\n      this.unsubscribeStorage = null;\n    }\n\n    // Cleanup each plugin\n    for (const plugin of this.plugins.values()) {\n      try {\n        plugin.cleanup();\n      } catch (error) {\n        console.error(`Failed to cleanup plugin ${plugin.meta.id}:`, error);\n      }\n    }\n\n    this.plugins.clear();\n  }\n\n  /**\n   * Enable a specific plugin\n   * @param id Plugin ID\n   */\n  async enable(id: string): Promise<void> {\n    const plugin = this.plugins.get(id);\n    if (!plugin) {\n      console.warn(`Plugin ${id} not found`);\n      return;\n    }\n\n    if (plugin.state === 'active') return;\n\n    try {\n      await plugin.start();\n    } catch (error) {\n      console.error(`Failed to enable plugin ${id}:`, error);\n    }\n  }\n\n  /**\n   * Disable a specific plugin\n   * @param id Plugin ID\n   */\n  disable(id: string): void {\n    const plugin = this.plugins.get(id);\n    if (!plugin) {\n      console.warn(`Plugin ${id} not found`);\n      return;\n    }\n\n    if (plugin.state !== 'active') return;\n\n    try {\n      plugin.stop();\n    } catch (error) {\n      console.error(`Failed to disable plugin ${id}:`, error);\n    }\n  }\n\n  /**\n   * Get a plugin by ID\n   * @param id Plugin ID\n   */\n  getPlugin(id: string): Plugin | undefined {\n    return this.plugins.get(id);\n  }\n\n  /**\n   * Get all registered plugins\n   */\n  getAllPlugins(): Plugin[] {\n    return Array.from(this.plugins.values());\n  }\n\n  /**\n   * Handle storage changes and route to appropriate plugins\n   */\n  private handleStorageChanges(changes: StorageChanges): void {\n    for (const plugin of this.plugins.values()) {\n      // Check for enabled state changes\n      if (plugin.meta.enabledKey in changes) {\n        const enabled = changes[plugin.meta.enabledKey].newValue !== false;\n        if (enabled) {\n          this.enable(plugin.meta.id);\n        } else {\n          this.disable(plugin.meta.id);\n        }\n      }\n\n      // Forward storage changes to plugin\n      if (plugin.onStorageChange) {\n        try {\n          plugin.onStorageChange(changes);\n        } catch (error) {\n          console.error(`Plugin ${plugin.meta.id} error handling storage change:`, error);\n        }\n      }\n    }\n  }\n}\n\n/**\n * Shared plugin manager instance\n */\nexport const pluginManager = new PluginManager();\n","/**\n * Plugin system types and base classes\n */\n\nimport type { PluginContext } from './PluginContext';\n\n/**\n * Plugin metadata\n */\nexport interface PluginMeta {\n  /** Unique identifier for the plugin */\n  id: string;\n  /** Human-readable name */\n  name: string;\n  /** Plugin version */\n  version: string;\n  /** Storage key for enabled state */\n  enabledKey: string;\n}\n\n/**\n * Plugin lifecycle states\n */\nexport type PluginState = 'registered' | 'initialized' | 'active' | 'inactive';\n\n/**\n * Storage change event type\n */\nexport type StorageChanges = { [key: string]: chrome.storage.StorageChange };\n\n/**\n * Plugin interface defining the contract for all plugins\n */\nexport interface Plugin {\n  /** Plugin metadata */\n  readonly meta: PluginMeta;\n  /** Current state of the plugin */\n  readonly state: PluginState;\n\n  /**\n   * Initialize the plugin with context\n   * Called once when plugin is first loaded\n   */\n  init(context: PluginContext): Promise<void>;\n\n  /**\n   * Start the plugin functionality\n   * Called when plugin is enabled\n   */\n  start(): Promise<void>;\n\n  /**\n   * Stop the plugin functionality\n   * Called when plugin is disabled\n   */\n  stop(): void;\n\n  /**\n   * Cleanup the plugin\n   * Called when plugin is being unloaded\n   */\n  cleanup(): void;\n\n  /**\n   * Handle storage changes\n   * Called when Chrome storage changes\n   */\n  onStorageChange?(changes: StorageChanges): void;\n}\n\n/**\n * Abstract base class for plugins\n * Provides common functionality and state management\n */\nexport abstract class BasePlugin implements Plugin {\n  abstract readonly meta: PluginMeta;\n\n  protected _state: PluginState = 'registered';\n  protected context!: PluginContext;\n\n  get state(): PluginState {\n    return this._state;\n  }\n\n  async init(context: PluginContext): Promise<void> {\n    this.context = context;\n    this._state = 'initialized';\n  }\n\n  async start(): Promise<void> {\n    if (this._state === 'active') return;\n    this._state = 'active';\n  }\n\n  stop(): void {\n    if (this._state !== 'active') return;\n    this._state = 'inactive';\n  }\n\n  cleanup(): void {\n    this.stop();\n    this._state = 'registered';\n  }\n\n  onStorageChange?(changes: StorageChanges): void;\n}\n","export type PnRule = \"p1\" | \"p2\" | \"p3\";\nexport type PnRuleSub = \"P1\" | \"P2\" | \"P3\";\nexport type PnBgColorKey = `${PnRule}-bg-color`;\nexport type PnTextColorKey = `${PnRule}-text-color`;\n\nexport type PnRuleMap = {\n  [key in PnRule]: string;\n};\nexport type PnRuleColorMap = {\n  [key in PnBgColorKey | PnTextColorKey]?: string;\n};\nexport type PnRuleMapWithColor = PnRuleMap & PnRuleColorMap;\n\nexport const DEFAULT_PN_RULE_MAP: PnRuleMapWithColor = {\n  p1: \"P1\",\n  p2: \"P2\",\n  p3: \"P3\",\n  \"p1-bg-color\": \"#dc2626\",\n  \"p1-text-color\": \"#ffffff\",\n  \"p2-bg-color\": \"#f59e0b\",\n  \"p2-text-color\": \"#ffffff\",\n  \"p3-bg-color\": \"#10b981\",\n  \"p3-text-color\": \"#ffffff\",\n};\n\nexport function getBgColorKey(pn: PnRule | PnRuleSub): PnBgColorKey {\n  return `${pn}-bg-color`.toLocaleLowerCase() as PnBgColorKey;\n}\n\nexport function getTextColorKey(pn: PnRule | PnRuleSub): PnTextColorKey {\n  return `${pn}-text-color`.toLocaleLowerCase() as PnTextColorKey;\n}\n\nexport function getReplacementKey(pn: PnRule | PnRuleSub): PnRule {\n  return pn.toLocaleLowerCase() as PnRule;\n}\n\nfunction pnRegexp() {\n  return /^([pP]\\d)\\s*[:.]?/;\n}\n\nexport function findPn(text: string) {\n  const match = text.match(pnRegexp());\n  return match?.[1];\n}\n\nexport function isPnRule(rule: string = \"\"): rule is PnRule {\n  return pnRegexp().test(rule);\n}\n\nexport function isPnRuleMap(map: unknown): map is PnRuleMapWithColor {\n  if (typeof map !== \"object\" || map === null) return false;\n  return [\"p1\", \"p2\", \"p3\"].every((key) => key in map);\n}\n","/**\n * MutationObserver management utilities\n */\n\ntype ObserverEntry = {\n  observer: MutationObserver;\n  target: Node;\n};\n\nconst observers: Map<string, ObserverEntry> = new Map();\n\nexport interface ObserverOptions {\n  id: string;\n  target: Node;\n  callback: MutationCallback;\n  config?: MutationObserverInit;\n}\n\nconst defaultConfig: MutationObserverInit = {\n  childList: true,\n  subtree: true,\n};\n\n/**\n * Creates and registers a MutationObserver\n */\nexport function createObserver(options: ObserverOptions): MutationObserver {\n  const { id, target, callback, config = defaultConfig } = options;\n\n  // Disconnect existing observer with same id\n  if (observers.has(id)) {\n    disconnectObserver(id);\n  }\n\n  const observer = new MutationObserver(callback);\n  observer.observe(target, config);\n\n  observers.set(id, { observer, target });\n\n  return observer;\n}\n\n/**\n * Disconnects a specific observer by id\n */\nexport function disconnectObserver(id: string): boolean {\n  const entry = observers.get(id);\n  if (entry) {\n    entry.observer.disconnect();\n    observers.delete(id);\n    return true;\n  }\n  return false;\n}\n\n/**\n * Disconnects all registered observers\n */\nexport function disconnectAllObservers(): void {\n  observers.forEach((entry) => {\n    entry.observer.disconnect();\n  });\n  observers.clear();\n}\n\n/**\n * Gets the count of active observers\n */\nexport function getObserverCount(): number {\n  return observers.size;\n}\n","export function debounce(func: Function, wait: number) {\n  let timeout: ReturnType<typeof setTimeout> | undefined;\n  return function (this: any, ...args: any[]) {\n    const later = () => {\n      timeout = undefined;\n      func.apply(this, args);\n    };\n    clearTimeout(timeout);\n    timeout = setTimeout(later, wait);\n  };\n}\n","export function genMarker({\n  name,\n  replacement,\n  bgColor,\n  textColor,\n}:{\n  name: string;\n  replacement: string;\n  bgColor?: string;\n  textColor?: string;\n}) {\n  return `<mark name=\"${name}\" style=\"background-color: ${bgColor}; color: ${textColor}\">${replacement}</mark>`;\n}\n","export function escapeHtml(unsafe: string) {\n  return unsafe\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&#039;\");\n};\n","import { genMarker } from \"@domain/html\";\nimport {\n  findPn,\n  getBgColorKey,\n  getReplacementKey,\n  getTextColorKey,\n  isPnRule,\n  PnRuleMapWithColor,\n  PnRuleSub,\n} from \"@domain/pn\";\nimport { getNotes } from \"@services/gitlab\";\nimport { escapeHtml } from \"@utils/html\";\n\n/**\n * Updates existing mark elements with new replacement values\n */\nexport function replaceText(replacementMap: Record<string, string>): void {\n  const marks = document.querySelectorAll(\"mark[name]\");\n\n  marks.forEach((mark) => {\n    if (!(mark instanceof HTMLElement)) return;\n\n    const rule = mark.getAttribute(\"name\")?.toLocaleLowerCase();\n    if (!isPnRule(rule)) return;\n\n    for (const key of Object.keys(replacementMap)) {\n      if (key.startsWith(rule)) {\n        const replacementKey = getReplacementKey(rule);\n        const bgColorKey = getBgColorKey(rule);\n        const textColorKey = getTextColorKey(rule);\n\n        if (replacementMap[replacementKey]) {\n          mark.textContent = escapeHtml(replacementMap[replacementKey]);\n        }\n        if (replacementMap[bgColorKey]) {\n          mark.style.backgroundColor = replacementMap[bgColorKey];\n        }\n        if (replacementMap[textColorKey]) {\n          mark.style.color = replacementMap[textColorKey];\n        }\n      }\n    }\n  });\n}\n\n/**\n * Replaces Pn prefixes in notes with styled markers\n */\nexport function replacePnText(replacementMap: PnRuleMapWithColor): void {\n  const notes = getNotes();\n\n  notes.forEach((note) => {\n    const pn = findPn(note.innerHTML);\n\n    if (pn && pn.toLowerCase() in replacementMap) {\n      const replacementKey = getReplacementKey(pn as PnRuleSub);\n      const bgColorKey = getBgColorKey(pn as PnRuleSub);\n      const textColorKey = getTextColorKey(pn as PnRuleSub);\n\n      note.innerHTML = note.innerHTML.replace(\n        pn,\n        genMarker({\n          name: pn,\n          bgColor: replacementMap[bgColorKey],\n          textColor: replacementMap[textColorKey],\n          replacement: escapeHtml(replacementMap[replacementKey]),\n        })\n      );\n    }\n  });\n}\n","import { isPnRuleMap, PnRuleMapWithColor } from \"@domain/pn\";\nimport { createObserver, disconnectObserver } from \"@utils/observer\";\nimport { debounce } from \"@utils/debounce\";\nimport { replacePnText } from \"./replacer\";\n\nconst OBSERVER_ID = \"pn-rule-observer\";\n\n/**\n * Creates a MutationObserver that watches for DOM changes\n * and applies Pn text replacements\n */\nexport function createPnRuleObserver(pnMap: PnRuleMapWithColor): void {\n  const debouncedCallback = debounce((mutations: MutationRecord[]) => {\n    mutations.forEach((mutation) => {\n      if (mutation.type === \"childList\" && isPnRuleMap(pnMap)) {\n        replacePnText(pnMap);\n      }\n    });\n  }, 20);\n\n  createObserver({\n    id: OBSERVER_ID,\n    target: document.body,\n    callback: debouncedCallback,\n    config: { childList: true, subtree: true },\n  });\n}\n\n/**\n * Disconnects the Pn rule observer\n */\nexport function disconnectPnRuleObserver(): void {\n  disconnectObserver(OBSERVER_ID);\n}\n","/**\n * PnRule Plugin - Replaces priority labels (P1, P2, P3) with styled markers\n */\n\nimport { BasePlugin, type PluginMeta, type StorageChanges, type PluginContext } from '@core/plugin';\nimport { DEFAULT_PN_RULE_MAP, type PnRuleMapWithColor } from '@domain/pn';\nimport { createPnRuleObserver, disconnectPnRuleObserver } from './observer';\nimport { replaceText } from './replacer';\n\nconst STORAGE_KEY_ENABLED = 'pn-rule-enabled';\n\nexport class PnRulePlugin extends BasePlugin {\n  readonly meta: PluginMeta = {\n    id: 'pn-rule',\n    name: 'Priority Label Replacer',\n    version: '1.0.0',\n    enabledKey: STORAGE_KEY_ENABLED,\n  };\n\n  private pnMap: PnRuleMapWithColor = { ...DEFAULT_PN_RULE_MAP };\n\n  override async init(context: PluginContext): Promise<void> {\n    await super.init(context);\n\n    // Load initial pn map from storage\n    const data = await context.storage.getAll();\n    this.pnMap = {\n      ...DEFAULT_PN_RULE_MAP,\n      ...data,\n    } as PnRuleMapWithColor;\n  }\n\n  override async start(): Promise<void> {\n    if (this._state === 'active') return;\n\n    createPnRuleObserver(this.pnMap);\n    await super.start();\n  }\n\n  override stop(): void {\n    if (this._state !== 'active') return;\n\n    disconnectPnRuleObserver();\n    super.stop();\n  }\n\n  override onStorageChange(changes: StorageChanges): void {\n    // Skip if it's just the enabled state change (handled by PluginManager)\n    if (Object.keys(changes).length === 1 && this.meta.enabledKey in changes) {\n      return;\n    }\n\n    // Update pnMap with changes\n    const tmpMap: Record<string, string> = {};\n    Object.entries(changes).forEach(([key, change]) => {\n      if (key !== this.meta.enabledKey) {\n        (this.pnMap as Record<string, unknown>)[key] = change.newValue;\n        tmpMap[key] = change.newValue;\n      }\n    });\n\n    // If active, apply changes immediately\n    if (this._state === 'active' && Object.keys(tmpMap).length > 0) {\n      replaceText(tmpMap);\n    }\n  }\n}\n","type FilterList = string[];\n\nexport function getKey() {\n  const url = new URL(window.location.href);\n  const pathname = url.pathname;\n  const [project] = pathname.split('/-/');\n  return `${project.slice(1)}-merge-request-recent-searches`;\n}\n\nexport function getFilterList() {\n  const key = getKey();\n  const value = localStorage.getItem(key);\n  if (!value) return [];\n  return JSON.parse(value) as FilterList;\n}\n\nexport function setFilterList(filterList: FilterList) {\n  const key = getKey();\n  localStorage.setItem(key, JSON.stringify(filterList));\n}\n\nexport function removeFilterByIndex(e: MouseEvent) {\n  const filterList = getFilterList();\n  const li = (e.target as HTMLButtonElement).parentElement?.parentElement;\n  const siblings = Array.from(li?.parentElement?.children ?? []);\n\n  if (!li || siblings.length === 0) {\n    console.warn(`cannot find li or siblings`);\n    return;\n  }\n  const idx = siblings.indexOf(li as Element);\n  if (idx === -1) {\n    console.warn(`cannot find index of ${li} from ${siblings}`);\n    return;\n  }\n  console.log(`remove filter at index ${idx}`, filterList);\n  filterList.splice(idx, 1);\n  setFilterList(filterList);\n}\n","export function RemoveButton() {\n  const removeButton = document.createElement('button');\n  removeButton.type = 'button';\n\n  removeButton.classList.add('custom-rm-btn');\n  removeButton.innerHTML = `\n<svg class=\"s16 close-icon\"><use xlink:href=\"/assets/icons-0b41337f52be73f7bbf9d59b841eb98a6e790dfa1a844644f120a80ce3cc18ba.svg#close\"></use></svg>\n  `;\n  return removeButton;\n}\n","/**\n * RmMrFilter Plugin - Adds delete buttons to MR filter history items\n */\n\nimport { BasePlugin, type PluginMeta, type PluginContext } from '@core/plugin';\nimport { createObserver, disconnectObserver } from '@utils/observer';\nimport { removeFilterByIndex } from './utils';\nimport { RemoveButton } from './ui/RemoveButton';\n\nconst STORAGE_KEY_ENABLED = 'rm-mr-filter-enabled';\nconst OBSERVER_ID = 'rm-mr-filter-observer';\n\nexport class RmMrFilterPlugin extends BasePlugin {\n  readonly meta: PluginMeta = {\n    id: 'rm-mr-filter',\n    name: 'MR Filter Remover',\n    version: '1.0.0',\n    enabledKey: STORAGE_KEY_ENABLED,\n  };\n\n  private getFilterDropdownButton: typeof import('@services/gitlab').getFilterDropdownButton = () => null;\n  private getFilterListItems: typeof import('@services/gitlab').getFilterListItems = () => null;\n  private SELECTORS: typeof import('@services/gitlab').SELECTORS = {} as typeof import('@services/gitlab').SELECTORS;\n\n  override async init(context: PluginContext): Promise<void> {\n    await super.init(context);\n\n    // Store gitlab accessors\n    this.getFilterDropdownButton = context.gitlab.getFilterDropdownButton;\n    this.getFilterListItems = context.gitlab.getFilterListItems;\n    this.SELECTORS = context.gitlab.SELECTORS;\n  }\n\n  override async start(): Promise<void> {\n    if (this._state === 'active') return;\n\n    const button = this.getFilterDropdownButton();\n    if (!button) {\n      // Button not found, but we still mark as started\n      // The observer will handle it when the button appears\n      await super.start();\n      return;\n    }\n\n    createObserver({\n      id: OBSERVER_ID,\n      target: button,\n      callback: () => this.addRemoveButtonsToFilters(),\n      config: { childList: true, subtree: true },\n    });\n\n    this.addRemoveButtonsToFilters();\n    await super.start();\n  }\n\n  override stop(): void {\n    if (this._state !== 'active') return;\n\n    disconnectObserver(OBSERVER_ID);\n    super.stop();\n  }\n\n  private addRemoveButtonsToFilters(): void {\n    const filterList = this.getFilterListItems();\n\n    filterList?.forEach((filter) => {\n      if (filter.querySelector(this.SELECTORS.customRemoveButton)) {\n        return;\n      }\n\n      const removeButton = RemoveButton();\n      filter.appendChild(removeButton);\n\n      removeButton.addEventListener('click', (e) => {\n        e.stopPropagation();\n        e.preventDefault();\n        removeFilterByIndex(e);\n        filter.remove();\n      });\n    });\n  }\n}\n","/**\n * Content script entry point\n * Uses PluginManager to orchestrate plugin lifecycle\n */\n\nimport 'virtual:uno.css';\nimport '../../styles/inject.css';\nimport { pluginManager } from '@core/plugin';\nimport { PnRulePlugin } from '@plugins/pn-rule';\nimport { RmMrFilterPlugin } from '@plugins/rm-mr-filter';\n\n// Register all plugins\npluginManager.register(new PnRulePlugin());\npluginManager.register(new RmMrFilterPlugin());\n\n// Initialize all plugins\npluginManager.initAll();\n\n// Cleanup on unload (for SPA navigation)\nwindow.addEventListener('beforeunload', () => pluginManager.cleanupAll());\n"],"names":["saveToChromeLocalStorage","map","resolve","error","getAllFromChromeLocalStorage","reject","data","subscribeToChromeStorage","callback","StorageService","__publicField","key","defaultValue","value","result","changes","change","storageService","EventBus","event","subscription","subscribers","remainingSubscribers","filtered","s","eventBus","SELECTORS","getNotes","getFilterDropdown","getFilterDropdownButton","getFilterListItems","dropdown","createPluginContext","gitlab","PluginManager","plugin","storageData","id","pluginManager","BasePlugin","context","DEFAULT_PN_RULE_MAP","getBgColorKey","pn","getTextColorKey","getReplacementKey","pnRegexp","findPn","text","match","isPnRule","rule","isPnRuleMap","observers","defaultConfig","createObserver","options","target","config","disconnectObserver","observer","entry","debounce","func","wait","timeout","args","later","genMarker","name","replacement","bgColor","textColor","escapeHtml","unsafe","replaceText","replacementMap","mark","_a","replacementKey","bgColorKey","textColorKey","replacePnText","note","OBSERVER_ID","createPnRuleObserver","pnMap","debouncedCallback","mutations","mutation","disconnectPnRuleObserver","STORAGE_KEY_ENABLED","PnRulePlugin","tmpMap","getKey","pathname","project","getFilterList","setFilterList","filterList","removeFilterByIndex","e","li","siblings","_b","idx","RemoveButton","removeButton","RmMrFilterPlugin","button","filter"],"mappings":"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"}