var ne=Object.defineProperty;var se=(c,a,u)=>a in c?ne(c,a,{enumerable:!0,configurable:!0,writable:!0,value:u}):c[a]=u;var i=(c,a,u)=>se(c,typeof a!="symbol"?a+"":a,u);(function(){"use strict";function c(r){return new Promise(t=>{try{chrome.storage.local.set(r,()=>{chrome.runtime.lastError?t({success:!1,error:new Error(chrome.runtime.lastError.message)}):t({success:!0,data:void 0})})}catch(e){t({success:!1,error:e instanceof Error?e:new Error(String(e))})}})}function a(){return new Promise((r,t)=>{try{chrome.storage.local.get(e=>{chrome.runtime.lastError?t(new Error(chrome.runtime.lastError.message)):r(e)})}catch(e){t(e instanceof Error?e:new Error(String(e)))}})}function u(r){return chrome.storage.onChanged.addListener(r),()=>{chrome.storage.onChanged.removeListener(r)}}class B{constructor(){i(this,"cache",{});i(this,"initialized",!1)}async init(){this.initialized||(this.cache=await a(),this.initialized=!0)}async getAll(){return this.initialized||await this.init(),{...this.cache}}async get(t,e){this.initialized||await this.init();const n=this.cache[t];return n!==void 0?n:e}async save(t){const e=await c(t);return e.success&&Object.assign(this.cache,t),e}subscribe(t){return u(e=>{Object.entries(e).forEach(([n,s])=>{s.newValue!==void 0?this.cache[n]=s.newValue:delete this.cache[n]}),t(e)})}}const g=new B;class T{constructor(){i(this,"events",new Map)}on(t,e){const n={callback:e,once:!1},s=this.events.get(t)||[];return s.push(n),this.events.set(t,s),()=>this.off(t,e)}once(t,e){const n={callback:e,once:!0},s=this.events.get(t)||[];return s.push(n),this.events.set(t,s),()=>this.off(t,e)}emit(t,e){const n=this.events.get(t);if(!n)return;const s=[];n.forEach(o=>{o.callback(e),o.once||s.push(o)}),s.length>0?this.events.set(t,s):this.events.delete(t)}off(t,e){const n=this.events.get(t);if(!n)return;const s=n.filter(o=>o.callback!==e);s.length>0?this.events.set(t,s):this.events.delete(t)}clear(){this.events.clear()}}const A=new T,f={notes:"div.note-body > div.note-text.md [data-sourcepos][dir='auto']",filterDropdown:"div.filtered-search-history-dropdown",filterDropdownButton:"button.filtered-search-history-dropdown-toggle-button",filterListItem:'li[data-testid="dropdown-item"]:not(.gl-text-subtle)',customRemoveButton:".custom-rm-btn"};function p(){return document.querySelectorAll(f.notes)}function m(){return document.querySelector(f.filterDropdown)}function $(){return document.querySelector(f.filterDropdownButton)}function K(){const r=m();return r?r.querySelectorAll(f.filterListItem):null}const D=Object.freeze(Object.defineProperty({__proto__:null,SELECTORS:f,getFilterDropdown:m,getFilterDropdownButton:$,getFilterListItems:K,getNotes:p},Symbol.toStringTag,{value:"Module"}));function k(){return{storage:g,eventBus:A,gitlab:D}}class I{constructor(){i(this,"plugins",new Map);i(this,"context");i(this,"unsubscribeStorage",null);this.context=k()}register(t){if(this.plugins.has(t.meta.id)){console.warn(`Plugin ${t.meta.id} is already registered`);return}this.plugins.set(t.meta.id,t)}async initAll(){await g.init(),this.unsubscribeStorage=g.subscribe(e=>{this.handleStorageChanges(e)});const t=await g.getAll();for(const e of this.plugins.values())try{await e.init(this.context),t[e.meta.enabledKey]!==!1&&await e.start()}catch(n){console.error(`Failed to initialize plugin ${e.meta.id}:`,n)}}cleanupAll(){this.unsubscribeStorage&&(this.unsubscribeStorage(),this.unsubscribeStorage=null);for(const t of this.plugins.values())try{t.cleanup()}catch(e){console.error(`Failed to cleanup plugin ${t.meta.id}:`,e)}this.plugins.clear()}async enable(t){const e=this.plugins.get(t);if(!e){console.warn(`Plugin ${t} not found`);return}if(e.state!=="active")try{await e.start()}catch(n){console.error(`Failed to enable plugin ${t}:`,n)}}disable(t){const e=this.plugins.get(t);if(!e){console.warn(`Plugin ${t} not found`);return}if(e.state==="active")try{e.stop()}catch(n){console.error(`Failed to disable plugin ${t}:`,n)}}getPlugin(t){return this.plugins.get(t)}getAllPlugins(){return Array.from(this.plugins.values())}handleStorageChanges(t){for(const e of this.plugins.values())if(e.meta.enabledKey in t&&(t[e.meta.enabledKey].newValue!==!1?this.enable(e.meta.id):this.disable(e.meta.id)),e.onStorageChange)try{e.onStorageChange(t)}catch(n){console.error(`Plugin ${e.meta.id} error handling storage change:`,n)}}}const d=new I;class v{constructor(){i(this,"_state","registered");i(this,"context")}get state(){return this._state}async init(t){this.context=t,this._state="initialized"}async start(){this._state!=="active"&&(this._state="active")}stop(){this._state==="active"&&(this._state="inactive")}cleanup(){this.stop(),this._state="registered"}}const y={p1:"P1",p2:"P2",p3:"P3","p1-bg-color":"#dc2626","p1-text-color":"#ffffff","p2-bg-color":"#f59e0b","p2-text-color":"#ffffff","p3-bg-color":"#10b981","p3-text-color":"#ffffff"};function w(r){return`${r}-bg-color`.toLocaleLowerCase()}function E(r){return`${r}-text-color`.toLocaleLowerCase()}function L(r){return r.toLocaleLowerCase()}function S(){return/^([pP]\d)\s*[:.]?/}function M(r){const t=r.match(S());return t==null?void 0:t[1]}function j(r=""){return S().test(r)}function q(r){return typeof r!="object"||r===null?!1:["p1","p2","p3"].every(t=>t in r)}const h=new Map,z={childList:!0,subtree:!0};function C(r){const{id:t,target:e,callback:n,config:s=z}=r;h.has(t)&&b(t);const o=new MutationObserver(n);return o.observe(e,s),h.set(t,{observer:o,target:e}),o}function b(r){const t=h.get(r);return t?(t.observer.disconnect(),h.delete(r),!0):!1}function V(r,t){let e;return function(...n){const s=()=>{e=void 0,r.apply(this,n)};clearTimeout(e),e=setTimeout(s,t)}}function H({name:r,replacement:t,bgColor:e,textColor:n}){return`<mark name="${r}" style="background-color: ${e}; color: ${n}">${t}</mark>`}function R(r){return r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function N(r){document.querySelectorAll("mark[name]").forEach(e=>{var s;if(!(e instanceof HTMLElement))return;const n=(s=e.getAttribute("name"))==null?void 0:s.toLocaleLowerCase();if(j(n)){for(const o of Object.keys(r))if(o.startsWith(n)){const l=L(n),O=w(n),x=E(n);r[l]&&(e.textContent=R(r[l])),r[O]&&(e.style.backgroundColor=r[O]),r[x]&&(e.style.color=r[x])}}})}function U(r){p().forEach(e=>{const n=M(e.innerHTML);if(n&&n.toLowerCase()in r){const s=L(n),o=w(n),l=E(n);e.innerHTML=e.innerHTML.replace(n,H({name:n,bgColor:r[o],textColor:r[l],replacement:R(r[s])}))}})}const P="pn-rule-observer";function G(r){const t=V(e=>{e.forEach(n=>{n.type==="childList"&&q(r)&&U(r)})},20);C({id:P,target:document.body,callback:t,config:{childList:!0,subtree:!0}})}function J(){b(P)}const Y="pn-rule-enabled";class W extends v{constructor(){super(...arguments);i(this,"meta",{id:"pn-rule",name:"Priority Label Replacer",version:"1.0.0",enabledKey:Y});i(this,"pnMap",{...y})}async init(e){await super.init(e);const n=await e.storage.getAll();this.pnMap={...y,...n}}async start(){this._state!=="active"&&(G(this.pnMap),await super.start())}stop(){this._state==="active"&&(J(),super.stop())}onStorageChange(e){if(Object.keys(e).length===1&&this.meta.enabledKey in e)return;const n={};Object.entries(e).forEach(([s,o])=>{s!==this.meta.enabledKey&&(this.pnMap[s]=o.newValue,n[s]=o.newValue)}),this._state==="active"&&Object.keys(n).length>0&&N(n)}}function _(){const t=new URL(window.location.href).pathname,[e]=t.split("/-/");return`${e.slice(1)}-merge-request-recent-searches`}function Q(){const r=_(),t=localStorage.getItem(r);return t?JSON.parse(t):[]}function X(r){const t=_();localStorage.setItem(t,JSON.stringify(r))}function Z(r){var o,l;const t=Q(),e=(o=r.target.parentElement)==null?void 0:o.parentElement,n=Array.from(((l=e==null?void 0:e.parentElement)==null?void 0:l.children)??[]);if(!e||n.length===0){console.warn("cannot find li or siblings");return}const s=n.indexOf(e);if(s===-1){console.warn(`cannot find index of ${e} from ${n}`);return}console.log(`remove filter at index ${s}`,t),t.splice(s,1),X(t)}function ee(){const r=document.createElement("button");return r.type="button",r.classList.add("custom-rm-btn"),r.innerHTML=`
<svg class="s16 close-icon"><use xlink:href="/assets/icons-0b41337f52be73f7bbf9d59b841eb98a6e790dfa1a844644f120a80ce3cc18ba.svg#close"></use></svg>
  `,r}const te="rm-mr-filter-enabled",F="rm-mr-filter-observer";class re extends v{constructor(){super(...arguments);i(this,"meta",{id:"rm-mr-filter",name:"MR Filter Remover",version:"1.0.0",enabledKey:te});i(this,"getFilterDropdownButton",()=>null);i(this,"getFilterListItems",()=>null);i(this,"SELECTORS",{})}async init(e){await super.init(e),this.getFilterDropdownButton=e.gitlab.getFilterDropdownButton,this.getFilterListItems=e.gitlab.getFilterListItems,this.SELECTORS=e.gitlab.SELECTORS}async start(){if(this._state==="active")return;const e=this.getFilterDropdownButton();if(!e){await super.start();return}C({id:F,target:e,callback:()=>this.addRemoveButtonsToFilters(),config:{childList:!0,subtree:!0}}),this.addRemoveButtonsToFilters(),await super.start()}stop(){this._state==="active"&&(b(F),super.stop())}addRemoveButtonsToFilters(){const e=this.getFilterListItems();e==null||e.forEach(n=>{if(n.querySelector(this.SELECTORS.customRemoveButton))return;const s=ee();n.appendChild(s),s.addEventListener("click",o=>{o.stopPropagation(),o.preventDefault(),Z(o),n.remove()})})}}d.register(new W),d.register(new re),d.initAll(),window.addEventListener("beforeunload",()=>d.cleanupAll())})();
//# sourceMappingURL=index.global.js.map
